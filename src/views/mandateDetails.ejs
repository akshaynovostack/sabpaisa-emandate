<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-T4F3SZLP');</script>
    <!-- End Google Tag Manager -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' *; media-src 'self' ; frame-src 'self'; form-action 'self' https://stage-securepay.sabpaisa.in https://securepay.sabpaisa.in;"/>
    <title>e-Mandate Registration Success</title>
    <style>
        /* ===== DESIGN TOKENS ===== */
        :root {
          /* Palette – neutrals */
          --white: #ffffff;
          --gray-050: #f8f9fa;
          --gray-100: #f5f8fc;
          --gray-200: #e9ecef;
          --gray-900: #172b4d;

          /* Palette – Finloom brand blues */
          --blue-500: #006ced;
          --blue-700: #002e8b;

          /* Palette – semantic */
          --success-500: #22bb66;
          --success-050: #e6f7ef;
          --error-500: #dc3545;
          --error-050: #ffeded;
          --warning-500: #ffc107;
          --warning-050: #fff8e1;

          /* Shadows & radii */
          --radius-sm: 4px;
          --radius-md: 10px;
          --radius-lg: 16px;
          --shadow-sm: 0 1px 2px rgba(0,0,0,.05);
          --shadow-md: 0 4px 16px rgba(0,46,139,.10);
          --shadow-lg: 0 8px 24px rgba(0,46,139,.15);

          /* Typography */
          --font-base: 'Inter', 'Segoe UI', Arial, sans-serif;
          --fs-base: 16px;
        }

        /* ===== THEME ===== */
        body {
          --brand-bg: var(--gray-100);
          --brand-primary: var(--blue-500);
          --brand-primary-dark: var(--blue-700);
          --hero-accent: var(--success-500);
          
          font: var(--fs-base)/1.5 var(--font-base);
          background: var(--brand-bg);
          color: var(--gray-900);
          margin: 0;
          padding: 20px;
        }

        /* ===== FINLOOM UI COMPONENTS ===== */
        .hero-icon {
          width: 80px; height: 80px;
          border-radius: 50%;
          background: var(--hero-accent);
          color: var(--white);
          display: flex; justify-content: center; align-items: center;
          font-size: 36px;
          font-weight: bold;
          box-shadow: 0 12px 24px rgba(34, 187, 102, 0.25);
          animation: iconBounceIn 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55),
                     iconPulse 2s infinite ease-in-out;
          margin: 0 auto 20px;
          position: relative;
          transition: transform 0.3s ease;
        }

        .hero-icon::before {
          content: '';
          position: absolute;
          width: 100%;
          height: 100%;
          border-radius: 50%;
          background: var(--hero-accent);
          opacity: 0.3;
          animation: ripple 2s infinite;
        }

        .hero-icon:hover {
          transform: scale(1.05);
        }

        /* ===== ENHANCED ANIMATIONS ===== */
        .hero-section {
          animation: slideUpFade 0.8s ease-out;
        }

        h1.hero-heading {
          font-size: 30px; font-weight: 700;
          color: var(--brand-primary-dark);
          margin: 12px 0 4px;
          animation: slideUpFade 0.6s ease-out 0.2s both;
        }

        p.hero-message { 
          font-size: 16px; 
          margin-bottom: 18px; 
          color: var(--gray-900);
          animation: slideUpFade 0.6s ease-out 0.3s both;
        }

        .tx-pill {
          display: inline-flex; align-items: center; gap: 8px;
          padding: 8px 16px; border-radius: 24px;
          background: var(--white);
          box-shadow: var(--shadow-md);
          transition: .3s;
          font-weight: 600; font-size: 14px;
          margin-bottom: 20px;
          animation: slideUpFade 0.6s ease-out 0.4s both;
        }

        .tx-pill button {
          background: none; border: none; cursor: pointer;
          color: var(--brand-primary); font-size: 14px;
        }

        .tx-pill:hover { 
          box-shadow: var(--shadow-lg); 
          transform: translateY(-2px); 
        }

        .card {
          background: var(--white); 
          border-radius: var(--radius-lg);
          box-shadow: var(--shadow-md); 
          overflow: hidden;
          padding: 28px; 
          margin: 20px 0; 
          position: relative;
          transition: .3s;
          animation: slideUpFade 0.6s ease-out 0.6s both;
        }

        .card:hover { 
          box-shadow: var(--shadow-lg); 
          transform: translateY(-3px); 
        }

        .btn-primary {
          width: 100%; padding: 16px; border: none;
          border-radius: var(--radius-md); font-weight: 600; cursor: pointer;
          position: relative; overflow: hidden; transition: .3s;
          display: flex; align-items: center; justify-content: center; gap: 8px;
          background: var(--brand-primary); 
          color: var(--white);
          text-decoration: none;
          font-size: 16px;
        }

        .btn-primary:hover { background: var(--brand-primary-dark); }
        .btn-primary:active { transform: translateY(1px); }

        .btn-secondary {
          width: 100%; padding: 12px; border: 1px solid var(--gray-200);
          border-radius: var(--radius-md); font-weight: 500; cursor: pointer;
          background: var(--white); color: var(--brand-primary);
          text-decoration: none; transition: .3s;
          display: flex; align-items: center; justify-content: center; gap: 8px;
          font-size: 14px;
        }

        .btn-secondary:hover { 
          background: var(--gray-050); 
          border-color: var(--brand-primary);
        }

        .accordion {
          border: 1px solid var(--gray-200);
          border-radius: var(--radius-md);
          margin: 20px 0;
          animation: slideUpFade 0.6s ease-out 0.7s both;
        }

        .accordion-header {
          padding: 18px 20px; cursor: pointer; display: flex;
          align-items: center; justify-content: space-between;
          transition: .2s; background: var(--white);
          font-weight: 600;
          color: var(--brand-primary);
        }

        .accordion-header:hover { background: var(--gray-100); }

        .accordion-content {
          max-height: 0; overflow: hidden; transition: max-height .3s ease;
          background: var(--gray-050);
        }

        .accordion.active .accordion-content { max-height: 500px; }

        .toast {
          position: fixed; bottom: 30px; right: 30px;
          background: var(--brand-primary-dark); color: var(--white);
          padding: 14px 18px; border-radius: var(--radius-md);
          box-shadow: var(--shadow-lg); opacity: 0; pointer-events: none;
          transition: opacity .4s, transform .4s;
          transform: translateY(20px);
        }

        .toast.show { 
          opacity: 1; 
          transform: translateY(0); 
          pointer-events: auto; 
        }

        /* ===== CUSTOM MANDATE COMPONENTS ===== */
        .container {
          max-width: 600px;
          margin: 0 auto;
          text-align: center;
        }

        .status-badge {
          display: inline-flex; align-items: center; gap: 6px;
          background: var(--success-500);
          color: var(--white);
          padding: 8px 14px;
          border-radius: 24px;
          font-size: 12px;
          font-weight: 600;
          text-transform: uppercase;
          letter-spacing: 0.5px;
          margin-bottom: 15px;
          animation: slideUpFade 0.6s ease-out 0.5s both;
          box-shadow: 0 4px 12px rgba(34, 187, 102, 0.2);
        }

        .details-grid {
          display: grid;
          grid-template-columns: 1fr 1fr 1fr;
          gap: 20px;
          text-align: left;
          margin: 20px 0;
        }

        .detail-item {
          padding: 16px;
          background: var(--gray-050);
          border-radius: var(--radius-md);
          border-left: 3px solid var(--brand-primary);
        }

        .detail-label {
          font-size: 12px;
          color: var(--gray-900);
          font-weight: 600;
          text-transform: uppercase;
          letter-spacing: 0.5px;
          margin-bottom: 6px;
          opacity: 0.7;
        }

        .detail-value {
          font-size: 14px;
          color: var(--gray-900);
          font-weight: 600;
          word-break: break-all;
        }

        .amount-highlight {
          color: var(--success-500);
          font-weight: 700;
          font-size: 16px;
        }

        .info-card {
          background: var(--success-050);
          border: 1px solid var(--success-500);
          border-radius: var(--radius-md);
          padding: 20px;
          margin: 20px 0;
          display: flex;
          align-items: flex-start;
          gap: 12px;
          text-align: left;
          animation: slideUpFade 0.6s ease-out 0.8s both;
        }

        .info-icon {
          color: var(--success-500);
          font-size: 20px;
          margin-top: 2px;
        }

        .info-content h3 {
          color: var(--brand-primary-dark);
          font-size: 16px;
          font-weight: 600;
          margin: 0 0 8px 0;
        }

        .info-content p {
          color: var(--gray-900);
          font-size: 14px;
          line-height: 1.5;
          margin: 0;
        }

        .back-home {
          position: absolute;
          top: 20px;
          right: 20px;
          background: var(--white);
          border: 1px solid var(--gray-200);
          color: var(--gray-900);
          padding: 8px 16px;
          border-radius: var(--radius-sm);
          text-decoration: none;
          font-size: 12px;
          font-weight: 500;
          transition: .3s;
        }

        .back-home:hover {
          background: var(--gray-050);
          border-color: var(--brand-primary);
        }

        .footer-security {
          background: var(--gray-050);
          padding: 12px 20px;
          text-align: center;
          color: var(--gray-900);
          font-size: 12px;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 6px;
          border-radius: var(--radius-md);
          margin-top: 20px;
          opacity: 0.8;
          animation: slideUpFade 0.6s ease-out 1s both;
        }

        .security-icon {
          color: var(--success-500);
        }

        /* ===== ENHANCED KEYFRAMES ===== */
        @keyframes iconBounceIn {
          0% {
            opacity: 0;
            transform: scale(0.2) rotate(-180deg);
          }
          50% {
            opacity: 1;
            transform: scale(1.1) rotate(0deg);
          }
          70% {
            transform: scale(0.95);
          }
          100% {
            opacity: 1;
            transform: scale(1);
          }
        }

        @keyframes iconPulse {
          0%, 100% {
            box-shadow: 0 12px 24px rgba(34, 187, 102, 0.25), 0 0 0 0 rgba(34, 187, 102, 0.3);
          }
          50% {
            box-shadow: 0 12px 24px rgba(34, 187, 102, 0.4), 0 0 0 10px rgba(34, 187, 102, 0);
          }
        }

        @keyframes ripple {
          0% {
            transform: scale(1);
            opacity: 0.3;
          }
          100% {
            transform: scale(1.5);
            opacity: 0;
          }
        }

        @keyframes slideUpFade {
          0% {
            opacity: 0;
            transform: translateY(40px);
          }
          100% {
            opacity: 1;
            transform: translateY(0);
          }
        }

        @keyframes bounceIn { 
          0% { transform: scale(.2); opacity: 0; } 
          100% { transform: scale(1); opacity: 1; } 
        }

        @keyframes pulse { 
          0%, 100% { box-shadow: 0 0 0 0 rgba(34, 187, 102, .3); } 
          50% { box-shadow: 0 0 0 12px rgba(34, 187, 102, 0); } 
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
          .details-grid {
            grid-template-columns: 1fr;
            gap: 15px;
          }
          
          .container {
            margin: 10px;
          }
          
          .back-home {
            position: static;
            display: inline-block;
            margin-bottom: 20px;
          }
          
          body {
            padding: 10px;
          }
        }
    </style>
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T4F3SZLP"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <a href="#" class="back-home">Back to Home</a>
    
    <main class="container">
        <!-- Hero Section -->
        <div class="hero-icon">✓</div>
        <h1 class="hero-heading">Hi, <%= mandate.customer_name || 'User' %>!</h1>
        <p class="hero-message">Your e-Mandate setup was successful on <%= new Date(mandate.created_on).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %>.</p>
        
        <!-- Transaction ID Pill -->
        <span class="tx-pill">
            <span id="mandateId"><%= mandate.registration_id %></span>
            <button data-copy data-value="<%= mandate.registration_id %>" onclick="copyToClipboard('<%= mandate.registration_id %>')">
                📋
            </button>
        </span>

        <!-- Status Badge -->
        <div class="status-badge">
            ✓ Mandate Active
        </div>

        <!-- Mandate Details Card -->
        <section class="card">
            <h2 style="color: var(--brand-primary-dark); margin: 0 0 20px 0; font-size: 20px;">Mandate Details</h2>
            
            <div class="details-grid">
                <div class="detail-item">
                    <div class="detail-label">Bank Account</div>
                    <div class="detail-value">
                        <%= mandate.bank_code %> Bank<br>
                        ****<%= mandate.account_number.slice(-4) %>
                    </div>
                </div>
                
                <div class="detail-item">
                    <div class="detail-label">Mandate Amount</div>
                    <div class="detail-value amount-highlight">₹<%= mandate.max_amount %>/<%= mandate.frequency.toLowerCase() %></div>
                </div>
                
                <div class="detail-item">
                    <div class="detail-label">Start Date</div>
                    <div class="detail-value"><%= new Date(mandate.start_date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %></div>
                </div>
                
                <div class="detail-item">
                    <div class="detail-label">End Date</div>
                    <div class="detail-value"><%= new Date(mandate.end_date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %></div>
                </div>
                
                <div class="detail-item">
                    <div class="detail-label">Frequency</div>
                    <div class="detail-value"><%= mandate.frequency %></div>
                </div>
                
                <div class="detail-item">
                    <div class="detail-label">Purpose</div>
                    <div class="detail-value"><%= mandate.purpose %></div>
                </div>
                
                <div class="detail-item">
                    <div class="detail-label">Account Holder</div>
                    <div class="detail-value"><%= mandate.account_holder_name %></div>
                </div>
                
                <div class="detail-item">
                    <div class="detail-label">Account Type</div>
                    <div class="detail-value"><%= mandate.account_type %></div>
                </div>
                
                <div class="detail-item">
                    <div class="detail-label">IFSC Code</div>
                    <div class="detail-value"><%= mandate.ifsc_code.toUpperCase() %></div>
                </div>
            </div>
        </section>

        <!-- Primary Action Button -->
        <a href="#" class="btn-primary">
            🏠 Go to Dashboard
        </a>

        <!-- Payment Schedule Accordion -->
        <div class="accordion" id="paymentAccordion">
            <div class="accordion-header" onclick="toggleAccordion('paymentAccordion')">
                <span>📅 View Payment Schedule</span>
                <span id="accordionIcon">▼</span>
            </div>
            <div class="accordion-content">
                <div style="padding: 20px;">
                    <div class="details-grid">
                        <div class="detail-item">
                            <div class="detail-label">Next Payment</div>
                            <div class="detail-value"><%= new Date(mandate.start_date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %></div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Payment Mode</div>
                            <div class="detail-value"><%= mandate.mode %></div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Amount Type</div>
                            <div class="detail-value"><%= mandate.amount_type %></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Information Card -->
        <div class="info-card">
            <div class="info-icon">ℹ️</div>
            <div class="info-content">
                <h3>Important Information</h3>
                <p>Your e-Mandate has been successfully registered with your bank. <%= mandate.frequency %> <%= mandate.amount_type.toLowerCase() %> payments of ₹<%= mandate.max_amount %> will be automatically debited from your account on the scheduled dates.</p>
            </div>
        </div>

        <!-- Download Certificate Button -->
        <a href="#" class="btn-secondary">
            ⬇️ Download Mandate Certificate
        </a>

        <!-- Security Footer -->
        <div class="footer-security">
            <span class="security-icon">🔒</span>
            Secured by e-Nach
        </div>
    </main>

    <!-- Toast Notification -->
    <div id="toast" class="toast">Mandate ID copied to clipboard!</div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize countdown and progress
            startCountdown();
        });

        function startCountdown() {
            const redirectUrl = "<%= redirectUrl %>";
            const enachResponse = document.getElementById('enach-response-data').getAttribute('data-response');
            
            let timeLeft = 10;
            
            const timer = setInterval(() => {
                timeLeft -= 1;
                
                // Add pulse animation when time is running low
                if (timeLeft <= 5) {
                    // You can add visual indicators here if needed
                }
                
                if (timeLeft === 0) {
                    clearInterval(timer);
                    submitForm(redirectUrl, enachResponse);
                }
            }, 1000);
        }

        function submitForm(redirectUrl, enachResponse) {
            // Create a form dynamically
            const form = document.createElement("form");
            form.method = "POST";
            form.action = redirectUrl;
            form.target = "_blank";
            
            // Add input fields to the form
            const params = {
                enachResponse: enachResponse,
            };
            
            for (const [key, value] of Object.entries(params)) {
                const input = document.createElement("input");
                input.type = "hidden";
                input.name = key;
                input.value = value;
                form.appendChild(input);
            }
            
            // Append form to the body and submit it
            document.body.appendChild(form);
            form.submit();
        }

        // Copy to clipboard functionality
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast();
            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
        }

        // Show toast notification
        function showToast() {
            const toast = document.getElementById('toast');
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Toggle accordion
        function toggleAccordion(accordionId) {
            const accordion = document.getElementById(accordionId);
            const icon = document.getElementById('accordionIcon');
            
            if (accordion.classList.contains('active')) {
                accordion.classList.remove('active');
                icon.textContent = '▼';
            } else {
                accordion.classList.add('active');
                icon.textContent = '▲';
            }
        }
    </script>
    
    <!-- Hidden element to store enachResponse data -->
    <div id="enach-response-data" data-response="<%= enachResponse %>" style="display: none;"></div>
  </body>
</html>
